---
author: "Santiago Pati√±o-Giraldo"
date: "21/7/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



This work will present the analysis for an anonymous subject about his/her daily
movement activities.

## Preparing the data

A couple of packages for the work are loaded at first
```{r results='hide'}
library(lubridate)
library(dplyr)
library(xtable)
```

First, we need to unzip the dataset -if wasn't made previously-

```{r}
if(!file.exists("activity.csv")){
        unzip(zipfile = "activity.zip")
}
```

Then, the data is loaded

```{r}
activity <- read.csv("activity.csv", header=TRUE)
```

It's important to check how the data is looking reviewing the head of dataset and
the class of the columns
```{r}
head(activity)
str(activity)
```

I'm not happy with the class of data, so, I will change them

```{r}
activity$date <- ymd(activity$date)
activity$interval <- as.factor(activity$interval)
```

##What is mean total number of steps taken per day?

To solve this question I group the data by date and then summarize the mean
```{r}
meansteps <- group_by(activity[complete.cases(activity),],date) %>% 
                summarize(daily.steps=sum(steps),
                mean_day=mean(steps,na.rm = TRUE),
                median.day=median(steps))
htmltable <- xtable(meansteps)
```

And the histogram of the total steps

```{r fig.align='center'}
hist(meansteps$daily.steps, main="Histogram of Mean Steps", ylim=c(0,30), 
     xlab = "Mean steps by day", col=2)
```
**Summary of data**
```{r results='asis'}
print(htmltable, type="html")
```

##What is the average daily activity pattern?
```{r fig.align='center', fig.height=5, fig.width=8}
intervalsteps <- group_by(activity[complete.cases(activity),],interval) %>% 
                summarize(mean=mean(steps,na.rm = TRUE))
with(intervalsteps, plot(interval,mean, type="b", main="Average steps by 5-min daily intervals"), 
     ylab="Average steps", xlab="5-min time interval")
abline(h = mean(intervalsteps$mean), col=2)
```
**Now we subset the max value interval**
```{r}
intervalsteps[intervalsteps$mean==max(intervalsteps$mean),]
```
That's means that the max average of steps is during the 8:35 interval

##Imputing missing values
**How many NA's we have**
```{r}
sum(is.na(activity$steps))
```
It's better as percentage
```{r}
sum(is.na(activity$steps))/nrow(activity)
```
We have a 13% missing values

**Imputate**

In this step, I will imputate the mean of the interval assigned to the missing data using function impute
```{r}
impute <- function (x)
{
        if(is.na(x[1])){
        ##Mean of the interval
        intmean <- intervalsteps[intervalsteps$interval==x[3],]
        
        x[1] <- round(intmean$mean,2)
        }
        x
}
```
Now, I create the new data.frame
```{r}
complete_activity <- apply(activity,1,impute)
complete_activity <- t(complete_activity) # Transpose de new matrix
complete_activity <- tbl_df(complete_activity) # Convert to a data.frame

# Change classes
complete_activity$steps <- as.integer(complete_activity$steps) 
complete_activity$date <- ymd(complete_activity$date)
complete_activity$interval <- as.factor(complete_activity$interval)
str(complete_activity)
```
Verify NA's in the new dataframe
```{r}
sum(is.na(complete_activity))
```